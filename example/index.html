<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>imagebox.js demo</title>
  <link rel="stylesheet" href="../imagebox.css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="../imagebox.js"></script>
  <style>
    * { margin: 0; padding: 0; }
    .imagebox-demo { position: absolute; top: 0; left: 0; right: 0; bottom: 0; }
  </style>
</head>
<body>

<div class="imagebox-demo">
  <img data-src="tall.jpg">
</div>

<script>
$(function() {
  var $container,
      $image,
      containerWidth,
      containerHeight,
      imageWidth, imageHeight,
      isImageLoaded = false;

  function init($el, containerWidth, containerHeight) {
    $container = $el;
    $image = $container.find("img");
    if ($image.length == 0) throw new Error("Unable to find image in lightbox.");

    var imageSrc = $image.attr("data-src");
    if (typeof(imageSrc) === "undefined" || imageSrc === "") throw new Error("Must set `data-src` on img tag");

    $container.addClass("imagebox-container");
    $container.css({width: containerWidth, height: containerHeight});

    $image.on('load', onImageLoad);
    $image.attr("src", imageSrc);
  }

  function onImageLoad(e) {
    imageWidth = $image.width(),
    imageHeight = $image.height();
    isImageLoaded = true;
    resizeFit();
  }

  function resizeFit() {
    if(!isImageLoaded) return;
    var newWidth = imageWidth,
        newHeight = imageHeight,
        paddingTop = 0,
        containerWidth = $container.width(),
        containerHeight = $container.height(),
        imageAspectRatio = imageWidth / imageHeight;
    var containerAspectRatio = containerWidth / containerHeight;

    if (imageAspectRatio >= containerAspectRatio) {
      if (imageWidth >= containerWidth) {
        newWidth = containerWidth;
        newHeight = imageHeight * (containerWidth / imageWidth);
      }
    }
    else {
      if (imageHeight >= containerHeight) {
        newWidth = imageWidth * (containerHeight / imageHeight);
        newHeight = containerHeight;
      }
    }

    if (newHeight < containerHeight) {
      paddingTop = (containerHeight - newHeight) / 2;
    }

    $image.css({width: newWidth, height: newHeight, "padding-top": paddingTop});
  }

  init($(".imagebox-demo"), "", "");
  $(window).on("resize", resizeFit);
});
</script>

</body>
</html>
